<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <title>Document</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #e5e5e5;
      }

      .item-notification {
        display: none;
      }

      .rate-star {
        width: 100px;
      }

      .add-to-cart {
        background-color: orange;
      }

      footer {
        text-align: center;
      }

      @media only screen and (min-width: 576px) {
        .product-image {
          height: 250px;
          object-fit: fill;
        }

        .product-name {
          height: 40px;
        }

        .mobile-border {
          display: none;
        }
      }

      @media only screen and (min-width: 768px) {
        .tablet-border {
          border-bottom: 1px solid grey;
        }
      }
    </style>
  </head>
  <body>
    <form class="d-flex" role="search">
      <input
        class="form-control me-2"
        type="search"
        placeholder="Search"
        aria-label="Search"
      />
      <button
        class="btn text-light"
        style="background-color: #ffa500"
        type="submit"
      >
        Search
      </button>
    </form>

    <div class="js-cart-quantity"></div>
    <div class="item-notification">product added</div>

    <div class="container">
      <div class="tablet-border my-3 row"></div>
      <div class="searchedResults my-3 row"></div>
    </div>

    <script>
      let cart = [];
      const products = [
        {
          id: "store-item-0001",
          image: "images/products/art.jpg",
          name: "Profile Sculpture",
          rating: {
            star: 4.5,
            rateValue: 521,
          },
          priceCent: 35000,
        },

        {
          id: "store-item-0002",
          image: "images/products/basketball.jpg",
          name: "Basket-Ball",
          rating: {
            star: 2.5,
            rateValue: 12,
          },
          priceCent: 12500,
        },

        {
          id: "store-item-0003",
          image: "images/products/belt.jpg",
          name: "Mens Belt",
          rating: {
            star: 3.5,
            rateValue: 24,
          },
          priceCent: 6500,
        },

        {
          id: "store-item-0004",
          image: "images/products/chair.jpg",
          name: "Outdoor/Recreation Chair",
          rating: {
            star: 4.0,
            rateValue: 121,
          },
          priceCent: 23000,
        },

        {
          id: "store-item-0005",
          image: "images/products/chandalier.jpg",
          name: "Luxury Chandalier",
          rating: {
            star: 5.0,
            rateValue: 89,
          },
          priceCent: 62000,
        },
      ];

      newDisplay = document.querySelector(".tablet-border");
      let productsHTML = "";

      //  GENERATE-THE-HTML

      products.forEach((product) => {
        productsHTML += `<div class="my-product col-sm-4 col-lg-2">
    <img
      src="${product.image}"
      class="product-image w-100"
    />
    <p class="product-name my-2">${product.name}</p>
    <div class="d-flex align-items-center">
      <img
        src="images/ratings/rating-${product.rating.star * 10}.png"
        loading="lazy"
        class="rate-star h-auto me-3"
      /><span class="text-primary">${product.rating.rateValue}</span>
    </div>
    <p class="my-1">&#8358; ${product.priceCent}</p>
    <div>
      <input
        type="number"
        value="1"
        min="1"
        max="99"
        class="select-quantity-${product.id} addPrice px-1"
      />
    </div>
    <button
      class="add-to-cart js-add-to-cart text-light my-4 mx-auto mx-sm-0 d-flex
      px-5 py-2 rounded shadow border-1" data-product-id="${product.id}"
    >
      Add to Cart
    </button>
    <div
      class="mobile-border border-secondary border-1 border-bottom mb-4"
    ></div>
  </div>`;
      });
      newDisplay.innerHTML = productsHTML;

      // ADD TO CART BUTTON

      let itemNotification = document.querySelector(".item-notification");

      let cartQuantity = 0;

      // RETRIEVE CART FROM LOCAL STORAGE

      const storedCartArrayString = localStorage.getItem("cart");
      if (storedCartArrayString) {
        const storedCartArray = JSON.parse(storedCartArrayString);
        cart = storedCartArray;
        console.log(cart);

        // Calculate Cart Quantity

        cart.forEach((item) => {
          cartQuantity += item.quantity;
        });

        // Update Cart Quantity Display

        document.querySelector(".js-cart-quantity").innerHTML = cartQuantity;
      }

      function calculateTotalAmount() {
        let totalAmount = 0;

        cart.forEach((item) => {
          const product = products.find((p) => p.id === item.id);
          if (product) {
            totalAmount += product.priceCent * item.quantity;
          }
        });
        return totalAmount;
      }

      // ADD-TO-CART-BUTTON

      function assignAddToCartListeners() {
        let jsAddToCart = document.querySelectorAll(".js-add-to-cart");

        jsAddToCart.forEach((button) => {
          button.addEventListener("click", () => {
            const productId = button.dataset.productId;

            let matchingItem;
            let selectQuantity = document.querySelector(
              `.select-quantity-${productId}`
            );
            selectQuantity = Number(selectQuantity.value);

            const index = cart.findIndex((item) => item.id === productId);

            if (index !== -1) {
              // Product already exists in the cart, update its quantity
              cart[index].quantity += selectQuantity;
            } else {
              // Product doesn't exist in the cart, add a new item
              const product = products.find((p) => p.id === productId);
              if (product) {
                cart.push({
                  ...product,
                  quantity: selectQuantity,
                });
              }
            }

            // Return Input Value to Default After Adding to Cart
            document.querySelector(`.select-quantity-${productId}`).value = 1;

            // Update cartQuantity
            cartQuantity += selectQuantity;

            // Update the cart quantity display
            document.querySelector(".js-cart-quantity").innerHTML =
              cartQuantity;

            // Save cart to localStorage
            const cartArrayString = JSON.stringify(cart);
            localStorage.setItem("cart", cartArrayString);

            // Save cartQuantity to localStorage
            const cartQuantityString = JSON.stringify(cartQuantity);
            localStorage.setItem("cartQuantity", cartQuantityString);

            // ITEM-NOTIFICATION
            itemNotification.style.display = "block";

            setTimeout(function () {
              itemNotification.style.display = "none";
            }, 1500);

            console.log(cart);
            // Calculate total amount
            const totalAmount = calculateTotalAmount();

            // Display total amount in the console
            console.log("Total Amount:", totalAmount);
          });
        });
      }

      assignAddToCartListeners();

      //  SEARCH PRODUCT

      const searchForm = document.querySelector("form");
      const searchInput = document.querySelector('input[type="search"]');
      const searchedResults = document.querySelector(".searchedResults");
      const tabletBorder = document.querySelector(".tablet-border");

      searchForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const searchTerm = searchInput.value.trim().toLowerCase();
        const filteredProducts = products.filter((product) =>
          product.name.toLowerCase().includes(searchTerm)
        );

        if (filteredProducts.length > 0) {
          tabletBorder.style.display = "none";
          searchedResults.innerHTML = "";

          filteredProducts.forEach((product) => {
            const productHTML = `
        <div class="my-product col-sm-4 col-lg-2">
          <img src="${product.image}" class="product-image w-100"/>
          <p class="product-name my-2">${product.name}</p>
          <div class="d-flex align-items-center">
            <img src="images/ratings/rating-${
              product.rating.star * 10
            }.png" loading="lazy" class="rate-star h-auto me-3"/>
            <span class="text-primary">${product.rating.rateValue}</span>
          </div>
          <p class="my-1">&#8358; ${product.priceCent}</p>
          <div>
            <input type="number" value="1" min="1" max="99" class="select-quantity-${
              product.id
            } px-1"/>
          </div>
          <button class="add-to-cart js-add-to-cart text-light my-4 mx-auto mx-sm-0 d-flex px-5 py-2 rounded shadow border-1" data-product-id="${
            product.id
          }">
            Add to Cart
          </button>
          <div class="mobile-border border-secondary border-1 border-bottom mb-4"></div>
        </div>
      `;
            searchedResults.innerHTML += productHTML;
          });
        } else {
          searchedResults.innerHTML = "<p>ITEM NOT FOUND</p>";
          tabletBorder.style.display = "None";
        }
        assignAddToCartListeners();
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
